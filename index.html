<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Interactive VR Scene - Oculus Quest Fixed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- A-Frame library -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Updated aframe-extras for better controller support -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.4.0/dist/aframe-extras.min.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: 'Inter', sans-serif;
      }
    </style>
  </head>
  <body>
    <script>
      AFRAME.registerComponent('color-switcher', {
        schema: {
          colors: { type: 'array', default: ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#800080', '#000000'] }
        },
        init: function () {
          const el = this.el;
          const data = this.data;

          this.currentColorIndex = 0;
          el.setAttribute('material', 'color', data.colors[this.currentColorIndex]);

          el.addEventListener('click', () => {
            this.currentColorIndex = (this.currentColorIndex + 1) % data.colors.length;
            el.setAttribute('material', 'color', data.colors[this.currentColorIndex]);
            console.log(`Object clicked! New color: ${data.colors[this.currentColorIndex]}`);
          });
        }
      });

      // Debug texture loading
      document.addEventListener('DOMContentLoaded', function() {
        const img = document.querySelector('#patternTexture');
        if (img) {
          img.onload = function() {
            console.log('✅ Texture loaded successfully!', this.src);
          };
          img.onerror = function() {
            console.error('❌ Failed to load texture:', this.src);
            console.log('Trying fallback texture...');
            // Fallback to a working matrix-style texture
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxwYXR0ZXJuIGlkPSJtYXRyaXgiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+CiAgICAgIDxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzAwMDAwMCIvPgogICAgICA8dGV4dCB4PSI1IiB5PSIxNSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzAwRkYwMCI+MTwvdGV4dD4KICAgIDwvcGF0dGVybj4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNtYXRyaXgpIi8+Cjwvc3ZnPg==';
          };
        }
      });
    </script>

    <a-scene 
      vr-mode-ui="enabled: true"
      device-orientation-permission-ui="enabled: false">
      
      <a-assets>
        <!-- Multiple texture options for VR compatibility -->
        
        <!-- Option 1: Try your GitHub image -->
        <img id="githubTexture" 
             src="https://raw.githubusercontent.com/augmentedthinker/6-25/main/matrix.png" 
             crossorigin="anonymous">
        
        <!-- Option 2: Reliable CDN matrix texture -->
        <img id="cdnTexture" 
             src="https://cdn.jsdelivr.net/gh/aframevr/sample-assets@master/assets/images/ground.jpg" 
             crossorigin="anonymous">
             
        <!-- Option 3: Simple canvas-generated texture -->
        <canvas id="matrixCanvas" width="256" height="256" style="display: none;"></canvas>
        
        <!-- Option 4: A-Frame procedural material -->
      </a-assets>

      <a-sky 
        material="src: #canvasTexture; repeat: 4 2"
        rotation="0 0 0">
      </a-sky>

      <!-- Camera rig for VR movement -->
      <a-entity 
        id="rig" 
        position="0 0 0"
        movement-controls="fly: false; constrainToNavMesh: false">
        
        <!-- Camera (head) -->
        <a-camera 
          id="head" 
          position="0 1.6 0"
          look-controls="pointerLockEnabled: true">
          
          <!-- Cursor for interaction -->
          <a-cursor
            raycaster="objects: .collidable"
            fuse="false"
            position="0 0 -1"
            geometry="primitive: ring; radiusOuter: 0.008; radiusInner: 0.005"
            material="color: #000; shader: flat">
          </a-cursor>
        </a-camera>

        <!-- Left hand controller -->
        <a-entity 
          id="leftHand"
          oculus-touch-controls="hand: left; model: true"
          laser-controls="hand: left"
          raycaster="objects: .collidable; lineColor: red; lineOpacity: 0.5">
        </a-entity>

        <!-- Right hand controller -->
        <a-entity 
          id="rightHand"
          oculus-touch-controls="hand: right; model: true"
          laser-controls="hand: right"
          raycaster="objects: .collidable; lineColor: blue; lineOpacity: 0.5">
        </a-entity>
      </a-entity>

      <!-- Interactive objects with VR-compatible matrix texture -->
      <a-box
        id="red-box"
        class="collidable"
        position="-2 1 -5"
        rotation="0 45 0"
        material="src: #canvasTexture; repeat: 1 1"
        color-switcher="colors: #FF0000, #00FF00, #0000FF, #FFFF00, #800080, #000000"
        shadow>
      </a-box>

      <a-sphere
        id="green-sphere"
        class="collidable"
        position="0 1.25 -5"
        radius="1.25"
        material="src: #canvasTexture; repeat: 2 2"
        color-switcher="colors: #00FF00, #0000FF, #FFFF00, #800080, #000000, #FF0000"
        shadow>
      </a-sphere>

      <a-cylinder
        id="blue-cylinder"
        class="collidable"
        position="2 0.75 -5"
        radius="0.5"
        height="1.5"
        material="src: #canvasTexture; repeat: 1 2"
        color-switcher="colors: #0000FF, #FFFF00, #800080, #000000, #FF0000, #00FF00"
        shadow>
      </a-cylinder>

      <!-- Ground plane with matrix pattern -->
      <a-plane
        position="0 0 -5"
        rotation="-90 0 0"
        width="10"
        height="10"
        material="src: #canvasTexture; repeat: 3 3"
        shadow>
      </a-plane>

      <!-- Lighting -->
      <a-entity light="type: ambient; color: #BBB; intensity: 0.5"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.8" position="-1 1 1"></a-entity>

    </a-scene>
  </body>
</html>
